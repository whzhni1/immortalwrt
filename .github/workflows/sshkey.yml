name: 生成SSH密钥

on:
  workflow_dispatch:  # 只有手动触发

jobs:
  generate-ssh:
    runs-on: ubuntu-latest
    steps:
    - name: 生成SSH密钥对
      run: |
        echo "🔄 正在生成SSH密钥对..."
        # 生成新的SSH密钥
        ssh-keygen -t ed25519 -f github_key -N "" -C "github-actions-$(date +%Y%m%d)"
        
        echo ""
        echo "=========================================="
        echo "✅ SSH密钥生成完成！请按以下步骤操作："
        echo "=========================================="
        echo ""
        echo "📋 第一步：复制下面的公钥内容"
        echo "=========================================="
        cat github_key.pub
        echo "=========================================="
        echo ""
        echo "🖱️ 第二步：将公钥添加到GitHub账户"
        echo "   1. 登录 GitHub.com"
        echo "   2. 点击右上角头像 → Settings"
        echo "   3. 左侧菜单选择 SSH and GPG keys"
        echo "   4. 点击 New SSH key"
        echo "   5. Title输入: GitHub Actions SSH"
        echo "   6. Key type保持默认"
        echo "   7. 粘贴上面复制的公钥内容"
        echo "   8. 点击 Add SSH key"
        echo ""
        echo "💾 第三步：保存私钥（重要！）"
        echo "=========================================="
        echo "私钥内容（请保存到安全位置）:"
        echo "=========================================="
        cat github_key
        echo "=========================================="
        echo ""
        echo "🔒 私钥用途说明："
        echo "   - 如果需要从其他位置访问，可能需要此私钥"
        echo "   - 请妥善保管，不要泄露给他人"
        echo "   - 如果丢失，可以重新生成新的密钥对"
        echo ""
        echo "✅ 完成以上步骤后，SSH菜单配置工作流就可以正常使用了！"
        
    - name: 上传密钥文件（可选）
      uses: actions/upload-artifact@v4
      with:
        name: ssh-keys
        path: |
          github_key
          github_key.pub
        retention-days: 1  # 只保留1天，确保安全
